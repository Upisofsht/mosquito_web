<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mosquito-map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="/css/styles.css" />
</head>
<body>
    <div id="container">
        <div id="map-container">
            <div id="map"></div>
        </div>
        <!-- 調整空間 -->
        <div id="space">
            <div id="address-charts-container">
                <!-- 動態插入圖表 -->
            </div>
        </div>
    </div>
</body>
<script src="/js/mapFunctions.js"></script>
<script src="/js/chart.js"></script>
<script>
    const map = L.map('map').setView([23.7, 121], 7); // 台灣中心地圖

    // 加載地圖圖層
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '© OpenStreetMap'
    }).addTo(map);

    window.addEventListener('resize', () => {
        map.invalidateSize(); // 刷新地圖大小
    });

    fetchAllAddressesAndRenderMarkers(map);

    // 初始化控制項（時間選擇器 + 下拉式選單）
    initControls(map, (startTime, endTime) => {
        fetchDataByTimeAndRenderMarkers(startTime, endTime, map);
    }, (filter) => {
        // 過濾條件更新後重新渲染標記
        fetchDataByTimeAndRenderMarkers(
            document.getElementById('start-time').value,
            document.getElementById('end-time').value,
            map
        );
    });
    const defaultStart = getDefaultStartTime();
    const defaultEnd = getDefaultEndTime();
    fetchDataByTimeAndRenderMarkers(defaultStart, defaultEnd, map);

    <!-- updateChart(); -->
</script>
</html>
